<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: 问题集锦篇 | 痞子_朱 运维之路.....]]></title>
  <link href="http://peter34861.github.io/blog/categories/wen-ti-ji-jin-pian/atom.xml" rel="self"/>
  <link href="http://peter34861.github.io/"/>
  <updated>2014-04-14T17:25:45+08:00</updated>
  <id>http://peter34861.github.io/</id>
  <author>
    <name><![CDATA[Peter Zhu]]></name>
    <email><![CDATA[zhuwen5720@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Gitlab 安装过程中遇到的各种问题。]]></title>
    <link href="http://peter34861.github.io/blog/2013/07/14/gitlab-error/"/>
    <updated>2013-07-14T00:00:00+08:00</updated>
    <id>http://peter34861.github.io/blog/2013/07/14/gitlab-error</id>
    <content type="html"><![CDATA[<p><p>Gitalab 5.3-stable 版本 已经把 gitolite 换成 gitlab-shell 了。其实安装方法很简单，官方的源里面就有。</p>
<p>安装文档：</p>
<p><a href="https://github.com/gitlabhq/gitlabhq/blob/master/doc/install/installation.md">https://github.com/gitlabhq/gitlabhq/blob/master/doc/install/installation.md</a></p>
<p>以下是我初次安装的时候遇到的问题，希望能帮助到没有安装成功的同学。（初次使用了下，还是很不错的）</p>
<p>&nbsp;</p>
<ul>
<li>当git clone 仓库的时候出现ssl 认证错误，执行以下的语句，再clone 就好了。</li>
</ul>
<p>export GIT_SSL_NO_VERIFY=true</p>
<p>&nbsp;</p>
<ul>
<li>当gem 或则 bundle 的时候很慢 可以进行以下设置。</li>
</ul>
<p>①.<br />
$ gem sources --remove https://rubygems.org/<br />
$ gem sources -a http://ruby.taobao.org/<br />
$ gem sources -l</p>
<p>②.<br />
更改Gemfile source<br />
source 'http://ruby.taobao.org/'</p>
<p>&nbsp;</p>
<ul>
<li>gem install charlock_holmes --version '0.6.9.4' 执行这个报错的时候 大多是输Icu版本不对。</li>
</ul>
<p>如果懒的话就直接找个rpm libicu-devel icu 版本要大于4.2的<br />
我是下载的<br />
wget http://download.icu-project.org/files/icu4c/4.2.1/icu4c-4_2_1-src.tgz<br />
tar xf &amp;&amp; ./configure &amp;&amp;make &amp;&amp; make install</p>
<p>&nbsp;</p>
<ul>
<li>/etc/init.d/gitlab start 报错</li>
</ul>
<p>Gemfile syntax error:<br />
/home/git/gitlab/Gemfile:14: syntax error, unexpected ':', expecting $end<br />
gem "mysql2", group: :mysql</p>
<p>这个是因为系统中存在两个版本的ruby 。因为版本不同语法也不同，所以会不认识。<br />
fix:<br />
mv /usr/bin/ruby /usr/bin/ruby.bak<br />
<!--more-->
ln -s /usr/local/bin/ruby /usr/bin/ruby</p>
<p>&nbsp;</p>
<ul>
<li>/usr/local/lib/ruby/gems/1.9.1/gems/bundler-1.3.5/lib/bundler/runtime.rb:216: warning: Insecure world writable dir /home/git/gitlab/vendor/bundle/ruby/1.9.1 in PATH, mode 040777</li>
</ul>
<p>权限问题。<br />
chmod go-w /home/git/gitlab -R</p>
<p>&nbsp;</p>
<ul>
<li>初始化通过ssh创建新的源的时候：fatal: Could not read from remote repository.Please make sure you have the correct access rights<br />
and the repository exists.</li>
</ul>
<p>首先我用的用户是administrator,然后邮箱地址是admin@local.host</p>
<p>后来我做了更改：</p>
<p>git config --global user.name "administrator"</p>
<p>git config --global user.email "admin@local.host"</p>
<p>改成</p>
<p>git config --global user.name "administrator"</p>
<p>git config --global user.email "zhuwen5720@gmail.com"</p>
<p>其实我也不是很理解这个，我只知道这样解决了这个问题。  如果不更改admin@local.host   只能在装gitlab 这台机器上创建新的repo.</p>
<ul>
<li>进入的gitlab 的project 里面，pdf 文件 和其他的文件不能下载。</li>
</ul>
<p>这个是gitlab 的一个bug, https://github.com/gitlabhq/gitlabhq/pull/4562 改下download.html 文件就好了。  已经提交到主版本库了，下个版本应该不会有问题了。</p>
<p>还有个提示。就是使用nginx 的配置文件的时候，最好不要去更改nginx 的gitlab.conf  用默认的就好了。</p>
<p>特别是哪个Listen 那一行。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div><embed id="ciba_grabword_plugin" width="0" height="0" type="application/ciba-grabword-plugin" hidden="true" /></div>
</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Zabbix 监控 Mysql]]></title>
    <link href="http://peter34861.github.io/blog/2013/06/23/zabbix_monitor_mysql/"/>
    <updated>2013-06-23T00:00:00+08:00</updated>
    <id>http://peter34861.github.io/blog/2013/06/23/zabbix_monitor_mysql</id>
    <content type="html"><![CDATA[<p>利用zabbxi 监控mysql 已经做过很多次了，但是每次做的时候都会有各种各样的问题。今天又碰到问题了，索性总结下，<br />
给日后排错留个记录。</p>




<p>zabbix 监控mysql ，官方已经提供了模板和脚本。其中之需要改改脚本就好了(mysql.php)<br />
本人添加监控和排错的时候借鉴了以下两篇文章，再此谢过两位前辈。</p>




<p>http://blog.csdn.net/adparking/article/details/7825183 （添加监控）<br />
http://1.guotie.sinaapp.com/?p=188 （调试）<br />
http://www.zabbix.com/wiki/howto/monitor/db/mysql/extensive_mysql_monitoring_including_replication?s[]=mysql 【官方模板】</p>




<p>我用了github 上了mysql_server 的模板。</p>




<p>下载模板 导入模板 创建关联这里就不说了。</p>




<p>本文主要是为了添加好了模板不出数据的而准备，配置都有问题的就别浪费时间查看了。<br />
一，先修改mysql.php 相关的内容。<br />
1， 添加权限 chmod +x mysql.php<br />
2, $config = file_get_contents('/etc/zabbix/zabbix_agentd.conf') 这里的路径要改成你自己的路径，应该有两个<br />
3， $cmd = "zabbix_sender -z $server -p 10051 -s $host -k ".SYSTEM.".$var -o $val"; 改成<br />
$cmd = "zabbix_sender -c $config -z $server -s bak10-001-89 -p 10055 -k ".SYSTEM.".$var -o $val -vv";<br />
这里一定要加上 “-s" 这个参数 参数后面可以跟着agentd 的机器ip 也可以跟着 在页面上写的这台agentd hostname</p>




<p>4， 权限的问题，有些人因为自己调试的时候用root用户执行了相关的脚本，导致日志生成的时候是root权限，zabbix 读不了。<br />
5， zabbix_sender 的环境变量的问题，很多人都是自己编译的，所以两种处理方式自己选。<br />
一种就是把自己的编译路径加入到系统环境变量中。<br />
二种直接软链，我选择这个<br />
6，因为我不是监控本地mysql, 所以Mysql.php 里面的Localhost 需要改成自己要监控的机器IP 添加相应的权限和用户。</p>




<p>&nbsp;</p>




<p>二，报错总结。<br />
Q1，”sent: 1; skipped: 0; total: 1<br />
info from server: "Processed 1 Failed 0 Total 1 Seconds spent 0.000083"“</p>




<p>A1仔细检查我所说的修改项 3 ， 自己手动把zabbix_mysql.dat 这个里面的命令自己手动测试下（端口，命令格式）。<br />
我看下来大多数是-s 这个参数，ip 和 hostname 都试试。<br />
前辈总结的这三点还是有道理的<br />
1、类型一定要是zabbix_trap类型；</p>


<!--more-->




<p>2、allowed ip要填写zabbix_sender的ip地址，如果有多个，使用,分割； （这个其实不用改也行）</p>




<p>3、zabbix_sender命令中的-s参数hostname要和server的web界面上一致；<br />
Q2，”/etc/zabbix/zabbix_agend.conf No such file or directory“<br />
A2, 检查下设置的第二项。</p>




<p>Q3："sh:zabbix_sender command not found"<br />
A3，检查设置5</p>




<p>&nbsp;</p>




<p>大概就这些，写的比较凌乱，有问题的欢迎交流。</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Nginx Proxy_pass 传递参数到后端]]></title>
    <link href="http://peter34861.github.io/blog/2013/01/28/nginx-proxy_pass_args/"/>
    <updated>2013-01-28T00:00:00+08:00</updated>
    <id>http://peter34861.github.io/blog/2013/01/28/nginx-proxy_pass_args</id>
    <content type="html"><![CDATA[<p>需求： 单域名 多应用 多主机请求。</p>




<p>例：http://bbs.linuxtone.org/thread-22458-1-1.html</p>




<p>解决办法</p>




<p>location /app2(.*) {<br />
proxy_pass http://app2/$1;<br />
proxy_set_header   Host $host;<br />
}</p>




<p>这样就可以实现了。</p>




<p>&nbsp;</p>




<p>实现这个功能后 ，发现url 里面如果有参数传递给后端，后端会接受不到。</p>




<p>例如：  www.test.com/app02/ur_id?123456</p>




<p>此时这个id number 无法传递到后端。 后来g 了下发现，proxy_pass 里面如果引用了变量，需要传递参数的话 需要在后面加入 ?$args ,否则后端无法接收。
<pre class="lang:c++ decode:true crayon-selected">location /app2(.*) {
        proxy_pass http://app2/$1?$args;      #此处添加
        proxy_set_header   Host $host;
        }</pre>
参考：http://www.tech126.com/nginx-proxy-pass-config/</p>




<p>&nbsp;</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[部署puppet 过程中的各种报错。]]></title>
    <link href="http://peter34861.github.io/blog/2012/10/19/install_puppet_error/"/>
    <updated>2012-10-19T00:00:00+08:00</updated>
    <id>http://peter34861.github.io/blog/2012/10/19/install_puppet_error</id>
    <content type="html"><![CDATA[<p><blockquote>1，Error: Failed to apply catalog: getaddrinfo: Temporary failure in name resolution<br >
Error: Could not send report: getaddrinfo: Temporary failure in name resolution</blockquote>
A1:请检查server 和 agent 的DNS 解析设置。两端都ping 下试试.</p>




<p>A2:如果DNS 设置都没问题的话,那指定下puppet 的解析为服务端的解析地址，因为默认的时候 agent 指定的 puppet, 所以在host 或则在DNS 里面设置 puppet 解析，再试试。
<blockquote>2, Error: Could not retrieve catalog from remote server: Error 400 on SERVER: Could not find class fish::base for web10-004.i.fish.com on node web10-004.i.fish.com</blockquote>
A1:在site.pp 里面加上你要加载的class 的名字，即使它能识别你的模块里面的Init.pp ，还是要加import "module_name", 然后再去调用 class 。</p>




<p>A2：先确定modules 的路径和配置文件里面的modules 是否一致，以前出现过 puppet config print modulepath 出现的路径和实际路径不一样导致模块一致加载不了
<blockquote>3,Error: Could not retrieve catalog from remote server: Error 400 on SERVER: Invalid parameter ower at /etc/puppet/modules/php-fpm/manifests/init.pp:21 on node web10-004.i.fish.com</blockquote>
&nbsp;</p>




<p>配置文件是这样的：
<blockquote>14 file {<br />
15 "php-fpm.conf":<br />
16 mode =&gt; 644, ower =&gt; root, group =&gt; root,<br />
17 ensure =&gt; present,<br />
18 name =&gt; "/usr/local/php-fpm/etc/php-fpm.conf",<br />
19 content =&gt; template("php-fpm/php-fpm.conf.erb"),<br />
20 require =&gt; Package["fish-php-fpm"]<br />
21 }</blockquote>
有没有眼睛尖的人看出问题的所在？</p>




<p>A1, 请先确认你的语法时候有错误，还有结束符之类的是否都对应（如果结束符不对称，会有提示的）</p>




<p>A2,请仔细查看你每个函数的名字是否都打对了，（我这个错误就是因为手贱一个字一个字的敲上去的结果把owner写成ower ，报错只报结束符有问题） 看了国外人的解释puppet 把file 看成一个整体，如果其中某一个函数出错了，他只会报在出错结束符那，所以当确保所有的用法都对的时候看看是否有关键词打错了。
<blockquote>4,运行 puppetd --server xx.xx.com --test</blockquote></p>




<p>notice: Run of Puppet configuration client already in progress; skipping
A1:解决方法： 部分情况下puppet服务会无法启动，且会提示puppet已经启动，这个时候需要删除一个文件。</p>




<p>&nbsp;
<blockquote>5，Error: Could not parse application options: invalid option: --servertype=mongrel</blockquote>
A1：  请确认 ruby mongrel 这个容器已经安装了。 可以用Yum  install 或则　gem  install (请参见puppet dashport)</p>




<p>&nbsp;</p>




<p>&nbsp;
<blockquote>6, 安装puppet-dashboard 时候执行数据库迁移的时候出现以下错误：</blockquote></p>




<!--more-->


<p>命令#
<pre><code>rake RAILS_ENV=production db:migrate （首先你要配置config/database.yml 这个文件里面的production）</code></pre>
** Execute environment<br />
rake aborted!<br />
Could not find rack (~&gt; 1.1.0) amongst [awesome_print-1.1.0, cgi_multipart_eof_fix-2.5.0, daemons-1.1.9, em-synchrony-1.0.2, eventmachine-1.0.0, eventmachine-1.0.0.rc.4, fastthread-1.0.7, gem_plugin-0.2.3, json-1.7.5, mongrel-1.1.5, mysql-2.8.1, rack-1.4.1, rake-0.9.2.2, rdoc-3.12, simpleconsole-0.1.1, slop-3.3.3, slop-2.4.4, system-0.1.0, task-0.0.1, update-0.9.8]
A1，上面明显已经安装了 rack-1-4-1，但它一直提示rack (~&gt; 1.1.0)， 最后经过网络人指导指定version 1.1.0 ,所以执行</p>




<p>gem install rack -v 1.1.0   再次执行上面的命令报错
<blockquote>rake aborted!<br />
can't activate rack-1.1.0, already activated rack-1.1.2   这个时候执行 gem install rack -v 1.1.2  问题解决。</blockquote></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[DNS 的常见报错]]></title>
    <link href="http://peter34861.github.io/blog/2012/09/12/dns_error/"/>
    <updated>2012-09-12T00:00:00+08:00</updated>
    <id>http://peter34861.github.io/blog/2012/09/12/dns_error</id>
    <content type="html"><![CDATA[<p><p><strong>1，<strong>none:0: open: etcnamed.conf: invalid file<p></p>

<p><p>当出现这种错误的情况下，原因大概有三种可能：</p></p>

<p><p><a href="http://blog.csdn.net/hiphen1/article/details/5818998">http://blog.csdn.net/hiphen1/article/details/5818998</a> 这位兄台总结了两个。</p></p>

<p><p>a) 错误连接导致</p></p>

<p><p>前提，我使用软连接，把/var/named/chroot/etc/named.conf链到 /etc/named.conf了。<br />
因为named启动在/var/named/chroot目录，所以如果在启动和变换路径后，还要这个软连接去找“/etc/named.conf”的话，当然会出错了。</p></p>

<p><p>解决：<br />
反过来，把/etc/named.conf链到/var/named/chroot/etc/named.conf即可。</p></p>

<p><p>b) 权限问题<br />
答曰：<br />
有可能是权限问题导致，检查/etc/named.conf，确认是否为named可以读取的。<br />
解决：<br />
把/var/named/chroot/etc/named.conf的拥有者改变一下。<br /></p>

<h1>ls -l /etc/named.conf<br /></h1>

<p>lrwxrwxrwx  1 root root 32 Nov 28 22:33 /etc/named.conf &ndash;&gt; /var/named/chroot/etc/named.conf</p></p>

<p><p>]# ls -l /var/named/chroot/etc/named.conf<br />
-rw-r&mdash;r&mdash;  1 root named 2415 Nov  5 09:15 /var/named/chroot/etc/named.conf</p></p>

<p><p>c) 目录问题</p></p>

<p><p>主要取决于/etc/sysconfig/named 这个文件，如果你的改变了ch_root 的路径，可能有些人会在这里面写入</p></p>

<p><p>ROOT_DIR=/etc/named</p></p>

<p><p>这个时候执行checkconfig 会报错的.</p></p>

<p><p>解决：</p></p>

<p><p>注释/etc/sysconfig/named  中#ROOT_DIR=</p></p>
]]></content>
  </entry>
  
</feed>
