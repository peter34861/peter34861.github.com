
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>简单安装NGINX 反向代理 - 痞子_朱 运维之路.....</title>
  <meta name="author" content="Peter Zhu">

  
  <meta name="description" content="*   安装Nginx
1.    gzip module requires zlib library
2. rewrite module requires pcre library
3. ssl support requires openssl library
一， 程序下载安装
1，     &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://peter34861.github.io/blog/2012/05/02/sample_installnginx_proxy">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="痞子_朱 运维之路....." type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">痞子_朱 运维之路.....</a></h1>
  
    <h2>Anything more than one way!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:peter34861.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">博客</a></li>
  <li><a href="/blog/archives">目录</a></li>
  <li><a href="/about/">我</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">简单安装NGINX 反向代理</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-02T00:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>*   安装Nginx<br />
1.    gzip module requires zlib library<br >
2. rewrite module requires pcre library<br />
3. ssl support requires openssl library<br />
一， 程序下载安装<br />
1，    Yum 包安装<br />
如果是CentOS 和 Rhel用户，安装Nginx 直接使用<br />
http://nginx.org/packages/rhel/5/noarch/RPMS/nginx-release-rhel-5-0.el5.ngx.noarch.rpm<br />
Yum 源， 这个是Nginx 官方维护的Yum源。<br />
# vi /etc/yum.repos.d/nginx.repo<br />
[nginx]<br />
name=nginx repo<br />
baseurl=http://nginx.org/packages/OS/OSRELEASE/$basearch/<br />
gpgcheck=0<br />
enabled=1<br />
# yum install nginx<br />
2，Deb 安装<br />
如果是Ubuntu,FreeBsd 用户<br />
# sudo apt-key add nginx_signing.key<br />
# deb http://nginx.org/packages/ubuntu/ lucid nginx<br />
# deb-src http://nginx.org/packages/ubuntu/ lucid nginx<br />
# apt-get update<br />
#apt-get install nginx<br />
3， 源码包编译安装。<br />
GW: http://nginx.org/en/download.html<br />
当前稳定版为 1.2.0<br />
# cd /srv<br />
# wget http://nginx.org/download/nginx-1.2.0.tar.gz<br />
# tar xf nginx-1.2.0.tar.gz<br />
# cd nginx-1.2.0<br />
#  ./configure<br />
#  make<br />
#  make install<br />
#默认安装的路径是/usr/local/nginx<br />
# ./configure<br />
&#8211;prefix=/etc/nginx \;                                             指定nginx安装目录<br />
&#8211;conf-path=/etc/nginx/nginx.conf \；                指定配置文件目录<br />
&#8211;sbin-path=/usr/sbin \；                                       指定可执行程序目录<br />
&#8211;error-log-path=/var/log/nginx/error.log \；   指定Error_log 目录<br />
&#8211;pid-path=/var/run/nginx.pid \；                       指定Pid保存目录<br />
&#8211;lock-path=/var/lock/subsys/nginx \；              指定nginx.lock 目录<br />
<!--more-->
&#8211;with-http_gzip_static_module \；                        打开Gzip 功能<br />
&#8211;http-client-body-temp-path=/var/cache/nginx/client_body_temp \；设置客户端临时文件目录<br />
&#8211;http-proxy-temp-path=/var/cache/nginx/proxy_temp \；设置代理临时文件目录<br />
&#8211;without-http_scgi_module \;                                                    关闭scgi 模块<br />
&#8211;without-http_uwsgi_module \；                                              关闭uwsgi模块<br />
&#8211;with-http_ssl_module \；                                                         开启SSL模块<br />
&#8211;with-md5=/usr/lib/openssl/ \；                                           enable MD5<br />
&#8211;with-sha1=/usr/lib/openssl/ \;                                             enable Shal<br />
&#8211;without-http_fastcgi_modul/ \;                                               关闭 fastcgi模块<br />
&#8211;with-pcre=/usr/include/pcre/ \;                                           启用正规表达式<br />
&#8211;with-http_stub_status_module/ \;                                          安装可以查看nginx状态的程序<br />
&#8211;with-http_rewrite_module/ \;                                                 启用支持url重写<br />
# make  &amp;&amp; make install<br />
二，    配置文件详解<br />
实例：<br />
user  nobody nobody;<br />
#启动进程<br />
worker_processes  8; 和Cpu 核数相同<br />
#全局错误日志及PID文件<br />
error_log  logs/error.log notice; 日志级别【debug,info,notice,warn,error,crit】<br />
pid        logs/nginx.pid;<br />
worker_rlimit_nofile 65535; 最大文件句柄<br />
#工作模式及连接数上限<br />
events {<br />
#工作模式有：select(标准模式),poll(标准模式),kqueue(高效模式，适用FreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0 and MacOS X),<br />
#epoll(高效模式，本例用的。适用Linux 2.6+,SuSE 8.2,),<br />
use epoll;<br />
worker_connections      1024;  单个进程最大连接数<br />
}
#设定http服务器，利用它的反向代理功能提供负载均衡支持<br />
http {<br />
#设定mime类型<br />
include      conf/mime.types;<br />
default_type  application/octet-stream;<br />
#设定日志格式<br />
log_format main        &#8216;$request_time $upstream_response_time $remote_addr - $upstream_addr  [$time_local] &#8217; &#8216;$host &#8220;$request&#8221; $status $bytes_sent &#8217; &#8216;&#8221;$http_referer&#8221; &#8220;$http_user_agent&#8221; &#8220;$gzip_ratio&#8221; &#8220;$http_x_forwarded_for&#8221; - &#8220;$server_addr&#8221;&#8217;;<br />
#设定请求缓冲<br />
client_header_buffer_size    10k; 用户请求头的大小<br />
large_client_header_buffers  4 4k; 指定用户较大的信息头的数量和大小，最大缓存4*4k 的<br />
#开启gzip模块，<br />
gzip on;<br />
gzip_min_length  1100; 允许Gzip的最小字节数。<br />
gzip_buffers    4 8k; 表示4个单位大小为8K的内存做为压缩结果流缓存<br />
gzip_types      text/plain; 用来指定压缩文件类型。<br />
output_buffers  1 32k;  指定输出的Buffer大小<br />
postpone_output  1460;<br />
#设定访问日志<br />
access_log  logs/access.log  main;<br />
client_header_timeout  3m;<br />
client_body_timeout    3m;<br />
send_timeout          3m; 发送超时<br />
sendfile                on; 打开传输<br />
tcp_nopush              on;<br />
tcp_nodelay            on;<br />
keepalive_timeout  65;<br />
#设定负载均衡的服务器列表<br />
upstream backserver {<br />
#weigth参数表示权值，权值越高被分配到的几率越大<br />
#本例是指在同一台服务器，多台服务器改变ip即可<br />
server 127.0.0.1:8081 weight=5;<br />
server 127.0.0.1:8082;<br />
server 127.0.0.1:8083;<br />
server 127.0.0.2;  如果是http的默认的80 端口，可以不用写。</p>

<p>}<br />
server {<br />
server_name  _;  #default<br />
return 404;<br />
}
#设定虚拟主机，默认为监听80端口，改成其他端口会出现问题<br />
server {<br />
listen         80;<br />
server_name    test.anjuke.com;<br />
charset utf8;<br />
#设定本虚拟主机的访问日志<br />
access_log  logs/test.com.log  main;<br />
#如果访问 /images/*, /js/*, /css/* 资源，则直接取本地文件，不用转发。但如果文件较多效果不是太好。<br />
location ~ ^/(images|js|css)/  {<br />
root    /usr/local/testweb;<br />
expires 30m;<br />
}</p>

<p>#对 &#8220;/&#8221; 启用负载均衡<br />
location / {<br />
proxy_pass      http://backserver;<br />
proxy_redirect          off;<br />
proxy_set_header        Host $host;<br />
proxy_set_header        X-Real-IP $remote_addr;<br />
proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;<br />
client_max_body_size    10m;<br />
client_body_buffer_size 128k;<br />
proxy_connect_timeout  90;<br />
proxy_send_timeout      90;<br />
proxy_read_timeout      90;<br />
proxy_buffer_size      4k;<br />
proxy_buffers          4 32k;<br />
proxy_busy_buffers_size 64k;<br />
proxy_temp_file_write_size 64k;}</p>

<p>#设定查看Nginx状态的地址,在运行./config 要指定，默认是不安装的。<br />
location /NginxStatus {<br />
stub_status            on;<br />
access_log             on;<br />
auth_basic             &#8220;NginxStatus&#8221;;<br />
#是否要通过用户名和密码访问，测试时可以不加上。conf/htpasswd 文件的内容用 apache 提供的 htpasswd 工具来产生即可#auth_basic_user_file  conf/htpasswd;<br />
}
}<br />
三，   Nginx基本维护<br />
1, Rpm 安装的Nginx<br />
开启  /etc/init.d/nginx start<br />
关闭  /etc/init.d/nginx stop<br />
重载配置文件： /etc/init.d/nginx reload<br />
Check_配置文件  /etc/init.d/nginx configtest</p>

<p>2, 编译安装的Nginx<br />
#  /usr/local/nginx/sbin/nginx –h<br />
Options:<br />
-?,-h         : this help<br />
-v            : show version and exit      ;显示版本号并退出<br />
-V            : show version and configure options then exit  ;显示版本号和配置参数并退出<br />
-t            : test configuration and exit ； 测试配置文件<br />
-q            : suppress non-error messages during configuration testing ;配置测试过程中输出非错误的信息。<br />
-s signal     : send signal to a master process: stop, quit, reopen, reload ; 给主进程发送信号（比如，stop,reopen ,reload）<br />
-p prefix     : set prefix path (default: /usr/local/nginx/)  ;指定路径<br />
-c filename   : set configuration file (default: conf/nginx.conf)； 指定主进程配置文件。<br />
-g directives : set global directives out of configuration file；  ; 设置全局配置文件目录<br />
以下都是读取默认编译的配置文件。<br />
开启：  /usr/local/nginx/sbin/nginx<br />
关闭： /usr/local/nginx/sbin/nginx –s stop<br />
重载配置： /usr/local/nginx/sbin/nginx –s reload<br />
Check配置文件：　/usr/local/nginx/sbin/nginx –t</p>

<p>读取指定配置文件  例如：/home/www/nginx.conf<br />
开启： /usr/local/nginx/sbin/nginx –c /home/www/nginx.conf<br />
关闭： /usr/local/nginx/sbin/nginx –c  /home/www/nginx.conf –s stop<br />
重载配置： /usr/local/nginx/sbin/nginx –c  /home/www/nginx.conf –s reload<br />
另外一种方式：kill –HUP  `ps –ef |grep nginx |grep master`<br />
测试配置文件： /usr/local/nginx/sbin/nginx –c  /home/www/nginx.conf –t</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Peter Zhu</span></span>

      








  


<time datetime="2012-05-02T00:00:00+08:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/fu-wu-pian/'>服务篇</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
  
     <body>
<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js"></script>
<!-- UY END -->
<!-- JiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
        <a class="jiathis_button_qzone"></a>
        <a class="jiathis_button_tsina"></a>
        <a class="jiathis_button_tqq"></a>
        <a class="jiathis_button_weixin"></a>
        <a class="jiathis_button_renren"></a>
        <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
        <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1394521006353195" charset="utf-8"></script>
<!-- JiaThis Button END -->
</body>

 
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/05/02/memcache_install/" title="Previous Post: Memcache 的简单安装">&laquo; Memcache 的简单安装</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/05/04/memcache_locked/" title="Next Post: Memcache 的死锁  （Hash table expansion starting）">Memcache 的死锁  （Hash table expansion starting） &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <image class='avatar' src="https://avatars1.githubusercontent.com/u/1792803?s=160">
  <p>运维#PingAn.</p>
  <p>新浪微博: <a href="http://weibo.com/peter34861">@peter34861</a><br/></p>

</nav>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/04/13/vsftd/">Vsftpd 安装和配置详解</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/17/xtrabackup_slave/">Xtrabackup 备份创建slave.</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/14/gitlab-error/">Gitlab 安装过程中遇到的各种问题。</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/23/zabbix_monitor_mysql/">Zabbix 监控 Mysql</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/30/heartbeat_ha_install/">Heartbeat HA 简单安装和配置</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/28/xtrabackup/">Xtrabackup 备份数据库</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/28/nginx-proxy_pass_args/">Nginx Proxy_pass 传递参数到后端</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/10/19/install_puppet_error/">部署puppet 过程中的各种报错。</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/12/dns_error/">DNS 的常见报错</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/04/puppet_register/">Puppet 常见报错之一 （认证不通过）</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/peter34861">@peter34861</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'peter34861',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Peter Zhu -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
